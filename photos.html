<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Photo Gallery</title>
  <style>
    :root { --bg:#0b1220; --card:#121a2b; --text:#e6e8ec; --muted:#9aa4bd; --accent:#8ab4ff; --border:#1f2a44; }
    * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    body { margin:0; background:linear-gradient(160deg,#0b1220,#0a1326); color:var(--text); min-height:100vh; }
    header { max-width:1100px; margin:28px auto 12px; padding:0 16px; display:flex; align-items:center; gap:12px; }
    h1 { margin:0; font-size:26px; letter-spacing:.2px; }
    .controls { margin-left:auto; }
    a.btnlink {
      background:#0d1b2a; color:var(--text); border:1px solid var(--border);
      border-radius:10px; padding:10px 12px; text-decoration:none;
    }
    main { max-width:1100px; margin:0 auto; padding:0 16px 28px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:14px; }
    .card { background:rgba(255,255,255,.03); border:1px solid var(--border);
            border-radius:14px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.25); }
    .thumb { width:100%; aspect-ratio:4/3; object-fit:cover; display:block; background:#0b1220; }
    .cap { padding:8px 10px; font-size:12px; color:var(--muted);
           white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
           border-top:1px solid var(--border); }
    .empty { margin:32px 0; color:var(--muted); text-align:center; }
    .lightbox { position:fixed; inset:0; background:rgba(0,0,0,.8);
                display:none; place-items:center; z-index:50; }
    .lightbox img { max-width:90vw; max-height:86vh; border-radius:12px; }
    .lightbox.show { display:grid; }
    .close { position:fixed; top:14px; right:16px; background:#141b2c;
             color:#e6e8ec; border:1px solid var(--border);
             border-radius:10px; padding:8px 10px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Photos</h1>
    <div class="controls">
      <a class="btnlink" href="/">← Back to Upload</a>
    </div>
  </header>

  <main>
    <div id="status" class="empty">Loading…</div>
    <div id="grid" class="grid" hidden></div>
  </main>

  <div id="lightbox" class="lightbox" onclick="hideLightbox(event)">
    <img id="lightimg" alt="">
    <button class="close" onclick="hideLightbox(event)">Close</button>
  </div>

  <script>
    const PHOTOS_BASE = '/mnt/newdisk/photos';
    const statusEl = document.getElementById('status');
    const grid = document.getElementById('grid');

    async function loadPhotos() {
      statusEl.hidden = false;
      grid.hidden = true;
      statusEl.textContent = 'Loading…';

      try {
        // Expect /photos/index.json => ["file1.jpg","file2.png",...]
        const res = await fetch(`${PHOTOS_BASE}/index.json`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const files = await res.json();
        renderGrid(files);
      } catch (e) {
        statusEl.innerHTML = `No manifest found at <code>${PHOTOS_BASE}/index.json</code>.<br>
        Create one like:<br>
        <code>ls photos -1 | jq -R -s 'split("\\n") | map(select(length&gt;0))' &gt; photos/index.json</code>`;
      }
    }

    function renderGrid(files) {
      grid.innerHTML = '';
      if (!Array.isArray(files) || files.length === 0) {
        statusEl.textContent = 'No photos yet.';
        grid.hidden = true;
        return;
      }
      files.forEach(name => {
        const url = `${PHOTOS_BASE}/${encodeURIComponent(name)}`;
        const card = document.createElement('div');
        card.className = 'card';
        const img = document.createElement('img');
        img.className = 'thumb';
        img.loading = 'lazy';
        img.src = url;
        img.alt = name;
        img.onclick = () => showLightbox(url, name);
        const cap = document.createElement('div');
        cap.className = 'cap';
        cap.textContent = name;
        card.appendChild(img);
        card.appendChild(cap);
        grid.appendChild(card);
      });
      statusEl.hidden = true;
      grid.hidden = false;
    }

    function showLightbox(src, alt) {
      const lb = document.getElementById('lightbox');
      const im = document.getElementById('lightimg');
      im.src = src; im.alt = alt;
      lb.classList.add('show');
    }
    function hideLightbox(e) {
      e.preventDefault();
      document.getElementById('lightbox').classList.remove('show');
    }

    loadPhotos();
  </script>
</body>
</html>
